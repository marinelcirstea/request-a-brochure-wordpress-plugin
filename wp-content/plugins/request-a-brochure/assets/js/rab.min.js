const rabForm=document.getElementById("rab-form"),chosenBrochures=[],minBrochures=1,maxBrochures=3;rabForm.querySelectorAll('input[type="checkbox"]').forEach(checkbox=>{checkbox.addEventListener("change",event=>{const checkbox=event.target,brochureId=checkbox.dataset.brochure_id;if(checkbox.checked){if(chosenBrochures.length>=3)return checkbox.checked=!1,alert("You can only choose 3 brochures.");chosenBrochures.push(brochureId)}else{const index=chosenBrochures.indexOf(brochureId);chosenBrochures.splice(index,1)}})}),rabForm.addEventListener("submit",async e=>{e.preventDefault();const formData={},inputs=rabForm.querySelectorAll("input:not([type='checkbox'])");return inputs.forEach(input=>{formData[input.name]=input.value}),chosenBrochures.length<1?alert("You must choose at least 1 brochure."):(formData.brochures=chosenBrochures,handleSubmit(formData))});const handleSubmit=async formData=>{const form=rabForm.parentElement;disable(form);const recaptchaResult=await getRecaptchaResult();if(!recaptchaResult.success||recaptchaResult.score<.5)return alert("reCAPTCHA failed.");const res=await fetch(`${SERVER_DATA.rest_url}/brochure-requests`,{method:"POST",headers:{"Content-Type":"application/json",Accepts:"application/json"},body:JSON.stringify(formData)}),data=await res.json();if(!res.ok)return data.message?alert(data.message):(enable(form),alert("Something went wrong on our side."));const success=document.createElement("div");success.classList.add("rab-success"),success.innerHTML="\n    <h2>Thank you for your request!</h2>\n    <p>We will be in touch with you shortly.</p>\n  ",form.replaceWith(success)},getRecaptchaResult=async()=>{const token=await grecaptcha.execute(`${SERVER_DATA.site_key}`,{action:"submit"}),res=await fetch(`${SERVER_DATA.rest_url}/brochure-recaptcha`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:token})}),data=await res.json();return data},disable=element=>{element.style.opacity=.5,element.style.pointerEvents="none"},enable=element=>{element.style.opacity=1,element.style.pointerEvents="auto"};